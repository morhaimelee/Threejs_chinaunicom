<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>省分大楼</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      /* 隐藏body窗口区域滚动条 */
      /* background-image: linear-gradient(rgb(46,81,255), #000); */
    }

    /* #cc {
      background-image: linear-gradient(rgb(46,81,255), #000);
    } */
    /* .label {
      width: 100px;
      height: 50px;
      color: #FFF;
      font-family: sans-serif;
      padding: 2px;
      background: rgb(87, 179, 248);
      opacity: .7;
      text-align: center;
      cursor: pointer;
      position: absolute;
      top: 500px;
      line-height: 50px;
    } */

    .moveDiv {
      width: 150px;
      height: 100px;
      color: #fff;
      background: rgb(87, 179, 248, 0.6);
      text-align: center;
      position: absolute;
      top: 300px;
      line-height: 100px;
      cursor: pointer;
    }

    #bianjie {
      position: absolute;
      top: 0;
      left: 30%;
      width: 100px;
      height: 20px;
      color: #fff;
    }

    .testDiv {
      position: absolute;
      padding: 10px;
      background: rgba(255, 255, 255, 0.6);
      line-height: 1;
      border-radius: 5px;
    }

    .videoIcon {
      width: 37px;
      height: 47px;
      position: absolute;
      background: url('./assets/imgs/摄像头.png') center center no-repeat;
      /* display: none; */
      cursor: pointer;
    }

    .gateIcon {
      width: 37px;
      height: 47px;
      position: absolute;
      background: url('./assets/imgs/zhaji.png') center center no-repeat;
      cursor: pointer;
    }

    .smokeIcon {
      width: 37px;
      height: 47px;
      position: absolute;
      background: url('./assets/imgs/烟感.png') center center no-repeat;
      cursor: pointer;
    }

    .waterIcon {
      width: 37px;
      height: 47px;
      position: absolute;
      background: url('./assets/imgs/水箱.png') center center no-repeat;
      cursor: pointer;
    }

    #camera_position {
      width: 100px;
      height: 100px;
      position: absolute;
      left: 100px;
      bottom: 200px;
      color: #fff;
      background: aqua;
    }
  </style>
  <link rel="stylesheet" href="./css/index_new.css" />
  <script src="https://cdn.staticfile.org/jquery/3.5.0/jquery.min.js"></script>
  <!--引入three.js三维引擎-->
  <script src="./js/three.js"></script>
  <!-- 引入threejs扩展控件OrbitControls.js -->
  <script src="./js/OrbitControls.js"></script>
  <!-- 引入gltf -->
  <script src="./js/GLTFLoader.js"></script>
  <!-- obj -->
  <!-- <script src="./js/OBJLoader.js"></script>
  <script src="./js/MTLLoader.js"></script> -->
  <!-- fps查看 -->
  <script src="./js/stats.min.js"></script>
  <!--加载控制器-->
  <script src="./js/TrackballControls.js"></script>
  <!-- 2D渲染器 -->
  <script src="./js/CSS2DRenderer.js"></script>
  <!--加载缓动插件-->
  <script src="./js/TweenMax.min.js"></script>

</head>

<body onload="draw();">
  <!-- <div class="moveDiv">点击移动</div> -->
  <!-- <div id="bianjie">便捷通行</div> -->
  <div class="testDiv"></div>
  <canvas id="cc"></canvas>
  <div class="topleft"></div>
  <nav class="nav">
    <ul>
      <li class="nav_list fl selected" id="equipment_warning">设备警告</li>
      <li class="nav_list fl" id="personnel_management">人员管理</li>
      <li class="nav_list fl" id="public_resource">公共资源</li>
      <li class="nav_list fl" id="environmental_management">环境管理</li>
      <!-- <li class="nav_list fl">办公运营</li> -->
    </ul>
  </nav>

  <!-- 左侧设备菜单 -->
  <div class="equipment-list">
    <ul>
      <li id="video_list"></li>
      <li id="waterTank_list"></li>
      <li id="fire_list"></li>
      <li id="temp_list"></li>
      <li id="gate_list"></li>
      <li id="trashCan_list"></li>
      <li id="hole_cover_list"></li>
      <li id="park_list"></li>
    </ul>
  </div>
  <section id="first_page" class="all_of_page">
    <!-- 监控设备运行录像 -->
    <div class="warnVideo-title">
      <i></i>
      <span>监控设备运行</span>
      <div>Monitoring equipment</div>
    </div>

    <!-- 随机影像 -->
    <div id="random-video">video</div>
    <div id="equip-num">
      <div>设备编号</div>
      <div>8T242</div>
    </div>
    <div id="equip-allnum">
      <i></i>
      <span class="point-yellow"></span>
      <span>设备总数量</span>
      <span id="equip_num">512</span>个
    </div>

    <!-- 设备数量细则 -->
    <div class="equip-list">
      <ol>
        <li><span class="point-yellow"></span> 运行数量</li>
        <li><span class="point-blue"></span> 离线数量</li>
        <li><span class="point-red"></span> 告警数量</li>
      </ol>
      <ul>
        <li><i></i> 478</li>
        <li><i></i> 24</li>
        <li><i></i> 10</li>
      </ul>
    </div>

    <section class="equip-online">
      <div class="warnVideo-title">
        <i></i>
        <span>设备在线情况</span>
        <div>Equipment online</div>
      </div>
      <div id="echarts_first_leftBottom"></div>
    </section>
    <!-- 右上时间&天气 -->
    <section class="time-date">
      <div id="time"></div>
      <div id="date"></div>
      <div id="vertical_bar"></div>
      <div id="weather"></div>
      <div id="temperature"></div>
    </section>
    <!-- 越界告警 -->
    <section class="cross-border-alarm">
      <div class="warnVideo-title">
        <i></i>
        <span>越界告警</span>
        <div>Cross-border alarm</div>
      </div>
    </section>
    <div class="visitors-box"></div>

    <!-- 安防告警 -->
    <section class="Security-alarm">
      <div class="warnVideo-title">
        <i></i>
        <span>安防告警</span>
        <div>Security alarm</div>
      </div>
      <div class="alarm-all-num-box">
        <ol>
          <li>告 警 总 数</li>
          <li>未 处 理</li>
          <li>已 处 理</li>
        </ol>
        <ul>
          <li>215</li>
          <li>15</li>
          <li>200</li>
        </ul>
      </div>

    </section>
    <!-- 设备状态异常滚动 -->
    <div class="equip-status-box">
      <ol>
        <li>设备</li>
        <li>告警消防</li>
        <li>告警时间</li>
        <li>状态</li>
      </ol>
      <div id="mid-line"></div>
      <ul>
        <li><span>烟感</span><span>烟雾告警</span><span>12-14 14:12</span><span>未处理</span></li>
        <li><span>电线温度</span><span>温度过高</span><span>12-14 14:12</span><span>已处理</span></li>
        <li><span>消防栓</span><span>水压过高</span><span>12-14 14:12</span><span>已处理</span></li>
      </ul>
    </div>
    <!-- 近三个月告警趋势 -->
    <section class="recent-trends">
      <div class="warnVideo-title">
        <i></i>
        <span>近3个月告警趋势</span>
        <div>Recent trends</div>
      </div>

    </section>
    <div id="echarts_first_rightBottom"></div>
  </section>
  <!-- 人员管理页签 -->
  <section id="second_page" class="all_of_page">
    <!-- 楼层总人数 -->
    <section class="total_number_of_floor">
      <div class="warnVideo-title">
        <i></i>
        <span>楼层总人数</span>
        <div>Security alarm</div>
      </div>
    </section>
    <div id="echarts_second_leftTop"></div>

    <!-- 今日人流量各时段统计 -->
    <section class="todays_statistics">
      <div class="warnVideo-title">
        <i></i>
        <span>今日人流量各时段统计</span>
        <div>Today's traffic statistics for each period</div>
      </div>
    </section>
    <div id="echarts_second_leftBottom"></div>

    <!-- 人员状况 -->
    <section class="people-status">
      <div class="warnVideo-title">
        <i></i>
        <span>人员状况</span>
        <div>People status</div>
      </div>
    </section>
    <div class="company-all-person-num">
      <div class="company-person">
        <span>公司员工 <div id="company_person">
            <ul class="person-single-num">
              <li>0</li>
              <li>3</li>
              <li>4</li>
              <li>5</li>
            </ul>
          </div>人</span>
      </div>
      <div class="visitor-person">
        <span>访客人员 <div id="visitor_person">
            <ul class="person-single-num">
              <li>0</li>
              <li>0</li>
              <li>4</li>
              <li>2</li>
            </ul>
          </div>人</span>
      </div>
    </div>
    </div>
    <!-- 访客进入实时数据 -->
    <section class="visitor-real-data">
      <div class="warnVideo-title">
        <i></i>
        <span>访客进入实时数据</span>
        <div>Visitors enter real-time data</div>
      </div>
    </section>
    <div class="visitor-realTime-data">
      <div class="realTime-box"></div>
      <div class="realTime-box"></div>
      <div class="realTime-box"></div>
    </div> 
  </section>



  <!-- 公共资源页签 -->
  <section id="thrid_page" class="all_of_page">

  </section>

  <section id="fourth_page" class="all_of_page">

  </section>
  <!-- <div class="btn_left" id="people_moni">安防监控</div> --> -->
  <!-- <div class="btn_left" id="in_ex_floor">进入大楼</div> -->

  <!--  value="play()" -->
  <!-- <div class="btn_left" id="gate">闸机</div>
  <div class="btn_left" id="smoke">烟感</div>
  <div class="btn_left" id="fire_waterP">消防水压</div>
  <div class="btn_left" id="line_temp">线缆温度</div>
  <div class="btn_left" id="back_all">返回主场景</div> -->

  <!-- <div id="bottomFloor">
    <ul>
      <li class="fl" id="f1">F1</li>
      <li class="fl" id="f2">F2</li>
      <li class="fl" id="f3">F3</li>
      <li class="fl" id="f4">F4</li>
      <li class="fl" id="f5">F5</li>
      <li class="fl" id="f6">F6</li>
      <li class="fl" id="f7">F7</li>
      <li class="fl" id="f8">F8</li>
      <li class="fl" id="f9">F9</li>
    </ul>
  </div>
  <div id="camera_position">相机位置</div> -->
  <script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.8.0/echarts.js"></script>
  <script src="./js/echarts-main.js"></script>
  <script src="./js/GetTime.js"></script>
  <script src="./js/weather.js"></script>
  <script src="./js/button.js"></script><!-- 按钮js -->
  <script>
    echarts.init(document.getElementById('echarts_first_leftBottom')).setOption(option1_first); //主页左下角echarts
    echarts.init(document.getElementById('echarts_first_rightBottom')).setOption(option2_first); //主页右下角echarts
    echarts.init(document.getElementById('echarts_second_leftTop')).setOption(option1_second); //二页左上角echarts
    echarts.init(document.getElementById('echarts_second_leftBottom')).setOption(option2_second); //二页左上角echarts
    let mixer = null
    let objAll = null
    let container, stats, controls

    let camera,
      scene,
      renderer,
      light,
      point,
      point3,
      directionalLight,
      directionalLight2,
      ambient

    let model

    let Vplace1 = []
    let Vplace2 = []
    let width, height, k, s

    let GLTFLoader_AllBuild,
      GLTFLoader_otherBuild,
      GLTFLoader_First,
      GLTFLoader_Video2,
      GLTFLoader_Video3,
      GLTFLoader_Video4

    let model_floor1, model_floor2, model_floor3, model_floor4, model_floor5
    let model_video1, model_video2, model_video3, model_video4, model_video5

    let video_path = './assets/sexiangtou.gltf'
    let gate_path = './assets/zhaji_real.gltf'
    let smoke_path = './assets/yangan.gltf'
    let water_path = './assets/water_box.gltf'

    let model_all = [] //所有模型
    let model_all_floor1 = [] //每层所有模型
    let model_all_floor2 = []
    let model_all_floor3 = []
    let model_all_floor4 = []
    let model_all_floor5 = []
    let model_all_floor6 = []
    let model_all_floor7 = []
    let model_all_floor8 = []
    let model_all_floor9 = []
    let model_all_floorB1 = []
    //创建控件对象  相机对象camera作为参数   控件可以监听鼠标的变化，改变相机对象的属性
    // controls = new THREE.OrbitControls(camera, renderer.domElement);

    function initStats() {
      stats = new Stats()
      document.body.appendChild(stats.dom)
    }

    function init() {
      renderer = new THREE.WebGLRenderer({
        antialias: true,
        canvas: document.querySelector('#cc'),
      })
      renderer.setPixelRatio(window.devicePixelRatio)
      renderer.setSize(window.innerWidth, window.innerHeight)
      renderer.shadowMap.enabled = true //渲染器接收阴影渲染

      renderer.setClearColor('rgb(0,47,94)', 1) //背景颜色像素及渲染
      // renderer.setClearColor('rgb(0,16,32)', 1)//进入楼层后更改

      // renderer.setClearColor('linear-gradient(rgb(46,81,255), #000)', 1.0);
      // renderer.setClearColor('rgba(135,206,250,0.5)',1.0);

      window.addEventListener('resize', onWindowResize, false) //窗口大小变化后，针对当前窗口大小比例渲染

      /**
       * 相机设置
       */
      width = window.innerWidth //窗口宽度
      height = window.innerHeight //窗口高度
      k = width / height //窗口宽
      // s = 300; //三维场景显示范围控制系数，系数越大，显示的范围越大
      // s = 250
      //创建相机对象
      // camera = new THREE.OrthographicCamera(-s * k, s * k, s, -s, 1, 2000);
      camera = new THREE.PerspectiveCamera(45, width / height, 1, 2000)
      camera.position.set(13.6, 10, 31.3) //设置相机位置
      // camera.position.set(10, 30, 100) //设置相机位置
      // camera.position.set(1000, 1000, 2000); //设置相机位置
      // camera.position.z = 2000

      // //监听鼠标事件，触发渲染函数，更新canvas画布渲染效果
      controls = new THREE.OrbitControls(
        camera,
        document.querySelector('#cc'),
      ) //添加控制器 //设置控制器。方便操控3d世界。
      // controls.target.set(0, 0, 0); //设置控制器控制中心点
      // controls.update(); //控制器更新
      //设置相机距离原点的最远距离`````````
      controls.minDistance = 1
      //设置相机距离原点的最远距离
      controls.maxDistance = 2000

      scene = new THREE.Scene() //创建场景
      scene.name = 'WEB_Scene'
      // camera.lookAt(scene.position); //设置相机方向(指向的场景对象)

      //增加背景图
      //   var loader = new THREE.TextureLoader();
      //   var backgroundTexture = loader.load( './assets/background/background.png');
      //   scene.background = backgroundTexture;

      // 模拟坐标轴
      var axesHelper = new THREE.AxesHelper(100)
      scene.add(axesHelper)
      /**
       * 光源设置
       */
      //点光源
      // point = new THREE.PointLight(0xffffff)
      // point.position.set(0, 8.63, 55.19) //点光源中间门上

      // scene.add(point) //点光源添加到场景中
      // var point2 = new THREE.PointLight(0x72b1ff);
      // point2.position.set(-554.418, 337.135, -20.433); //点光源左侧
      // scene.add(point2); //点光源添加到场景中
      // point3 = new THREE.PointLight(0x72b1ff);
      // point3.position.set(463.018, 278.976, -21.585); //点光源右侧
      // scene.add(point3); //点光源添加到场景中
      // var point4 = new THREE.PointLight(0x72b1ff);
      // point4.position.set(136.340, 336.995, -438.744); //点光源后侧
      // scene.add(point4); //点光源添加到场景中
      // var point5 = new THREE.PointLight(0x72b1ff);
      // point5.position.set(-52.809, 385.392, 610.896); //左圈
      // scene.add(point5); //点光源添加到场景中

      //平行光
      directionalLight = new THREE.DirectionalLight(0xffffff, 2.5)
      directionalLight.name = 'directionalLight'
      directionalLight.position.set(9, 13, 80)
      scene.add(directionalLight)

      directionalLight2 = new THREE.DirectionalLight(0xffffff, 1)
      directionalLight2.name = 'directionalLight2'
      directionalLight2.position.set(2, 8, -550)
      // scene.add(directionalLight2)
      // 环境光
      // ambient = new THREE.AmbientLight(0x72b1ff);
      ambient = new THREE.AmbientLight(0xffffff, 2.5)
      ambient.name = 'ambient'
      scene.add(ambient)

      //天空盒
      // var path = "./assets/background/"; //设置路径
      // var directions = ["px", "nx", "py", "ny", "pz", "nz"]; //获取对象
      // var format = ".png"; //格式
      // //创建盒子，并设置盒子的大小为( 5000, 5000, 5000 )
      // var skyGeometry = new THREE.BoxGeometry(1000, 1000, 1000);
      // //设置盒子材质
      // var materialArray = [];
      // for (var i = 0; i < 6; i++)
      //   materialArray.push(new THREE.MeshBasicMaterial({
      //     map: THREE.ImageUtils.loadTexture(path + directions[i] + format), //将图片纹理贴上
      //     side: THREE.BackSide /*镜像翻转，如果设置镜像翻转，那么只会看到黑漆漆的一片，因为你身处在盒子的内部，所以一定要设置镜像翻转。*/
      //   }));
      // var skyMaterial = new THREE.MeshFaceMaterial(materialArray);
      // var skyBox = new THREE.Mesh(skyGeometry, skyMaterial); //创建一个完整的天空盒，填入几何模型和材质的参数
      // scene.add(skyBox); //在场景中加入天空盒

      //非交互模型加载

      /**
       * OBJ和材质文件mtl加载
       */
      // var OBJLoader = new THREE.OBJLoader();//obj加载器
      // var MTLLoader = new THREE.MTLLoader();//材质文件加载器
      // MTLLoader.load('./assets/obj/number.mtl', function(materials) {
      //   // 返回一个包含材质的对象MaterialCreator
      //   console.log(materials);
      //   //obj的模型会和MaterialCreator包含的材质对应起来
      //   OBJLoader.setMaterials(materials);
      //   OBJLoader.load('./assets/obj/number.obj', function(obj) {
      //     console.log(obj);
      //     // obj.scale.set(10, 10, 10); //放大obj组对象
      //     scene.add(obj);//返回的组对象插入场景中
      //   })
      // })

      //DracoLoader
      // var loader = new DRACOLoader();
      // loader.setDecoderPath('./assets/new_gltf/otherDraco.gltf')

      // loader.preload()

      // loader.load(

      // )

      GLTFLoader_AllBuild = new THREE.GLTFLoader()
      GLTFLoader_AllBuild.load('./assets/new_gltf/main_build.gltf', function (obj) {
        //道路及大楼
        // objAll = obj
        obj.scene.name = 'all'
        scene.add(obj.scene)
      })

      GLTFLoader_AllBuild = new THREE.GLTFLoader()
      GLTFLoader_AllBuild.load('./assets/new_gltf/ground.gltf', function (obj) {
        //道路及大楼
        obj.scene.name = 'ground'
        scene.add(obj.scene)
        // let ground_obj = scene.getObjectByName('ground')
        obj.scene.children[0].traverse(function (obj) {
          if (obj.isMesh) {
            obj.material.color.set(0x000000)
            obj.material.emissive.set(0x001435)
          }
        })
      })

      GLTFLoader_AllBuild = new THREE.GLTFLoader()
      GLTFLoader_AllBuild.load('./assets/new_gltf/road.gltf', function (obj) {
        //道路及大楼
        // objAll = obj
        obj.scene.name = 'road'
        scene.add(obj.scene)
        obj.scene.traverse(function (obj) {
          if (obj.isMesh) {
            obj.material.color.set(0x17FFFF)
            obj.material.emissive.set(0x28E4FF)
          }
        })
      })

      GLTFLoader_otherBuild = new THREE.GLTFLoader()
      GLTFLoader_otherBuild.load('./assets/new_gltf/other.gltf', function (obj) {
        //道路及大楼
        // objAll = obj
        console.log(obj)
        obj.scene.name = 'other'
        scene.add(obj.scene)


        obj.scene.traverse(function (obj) {
          if (obj.isMesh) {
            obj.material.metalness = 0.2
            obj.material.roughness = 0.36
            obj.material.color.set(0x00091C)
            obj.material.emissive.set(0x000000)
          }
        })
      })

      GLTFLoader_First = new THREE.GLTFLoader();
      GLTFLoader_First.load('./assets/new_gltf/内部建模/1楼/1楼.gltf', function (obj) { //第一层楼
        model_floor1 = obj.scene
        scene.add(obj.scene)
        obj.scene.name = "1floor"
        model_floor1.visible = false
      })

      GLTFLoader_Video2 = new THREE.GLTFLoader();
      GLTFLoader_Video2.load('./assets/new_gltf/内部建模/2楼/2楼.gltf', function (obj) {
        model_floor2 = obj.scene
        scene.add(obj.scene)
        obj.scene.name = "2floor"
        model_floor2.visible = false
      })

      GLTFLoader_Video3 = new THREE.GLTFLoader();
      GLTFLoader_Video3.load('./assets/new_gltf/内部建模/3楼/3.gltf', function (obj) {
        model_floor3 = obj.scene
        obj.scene.name = "3floor"
        scene.add(obj.scene)
        model_floor3.visible = false
      })

      GLTFLoader_Video4 = new THREE.GLTFLoader();
      GLTFLoader_Video4.load('./assets/new_gltf/内部建模/4楼/4楼.gltf', function (obj) {
        model_floor4 = obj.scene
        obj.scene.name = "4floor"
        scene.add(obj.scene)
        model_floor4.visible = false
      })

      GLTFLoader_Video5 = new THREE.GLTFLoader();
      GLTFLoader_Video5.load('./assets/new_gltf/内部建模/5楼/5楼.gltf', function (obj) {
        model_floor5 = obj.scene
        obj.scene.name = "5floor"
        scene.add(obj.scene)
        model_floor5.visible = false
      })

      GLTFLoader_Video6 = new THREE.GLTFLoader();
      GLTFLoader_Video6.load('./assets/new_gltf/内部建模/6楼/6楼.gltf', function (obj) {
        model_floor6 = obj.scene
        obj.scene.name = "6floor"
        scene.add(obj.scene)
        model_floor6.visible = false
      })

      GLTFLoader_Video7 = new THREE.GLTFLoader();
      GLTFLoader_Video7.load('./assets/new_gltf/内部建模/7楼/7楼.gltf', function (obj) {
        model_floor7 = obj.scene
        obj.scene.name = "7floor"
        scene.add(obj.scene)
        model_floor7.visible = false
      })

      GLTFLoader_Video8 = new THREE.GLTFLoader();
      GLTFLoader_Video8.load('./assets/new_gltf/内部建模/8楼/8楼.gltf', function (obj) {
        model_floor8 = obj.scene
        obj.scene.name = "8floor"
        scene.add(obj.scene)
        model_floor8.visible = false
      })

      GLTFLoader_Video9 = new THREE.GLTFLoader();
      GLTFLoader_Video9.load('./assets/new_gltf/内部建模/9楼/9楼.gltf', function (obj) {
        model_floor9 = obj.scene
        obj.scene.name = "9floor"
        scene.add(obj.scene)
        model_floor9.visible = false
      })

      $('#back_all').hide()
    }

    // 点击隐藏
    // var moonDiv = document.createElement('div');
    // moonDiv.className = 'label';
    // moonDiv.textContent = '点击折叠';
    // let bodyDom = document.body;
    // bodyDom.insertBefore(moonDiv, bodyDom.lastChild);

    let model_all_num = {}
    model_all_num['model_all_floor' + 1] = []
    model_all_num['model_all_floor' + 2] = []
    model_all_num['model_all_floor' + 3] = []
    model_all_num['model_all_floor' + 4] = []
    model_all_num['model_all_floor' + 5] = []
    model_all_num['model_all_floor' + 6] = []
    model_all_num['model_all_floor' + 7] = []
    model_all_num['model_all_floor' + 8] = []
    model_all_num['model_all_floor' + 9] = []

    let tween1,
      tween2,
      tween3,
      tween4,
      tween5,
      tween6,
      tween7,
      tween8,
      tween9,
      tween10,
      tween_camera,
      tween_smoke

    function fold_all() {
      if (model_floor1.position.y != -120) {
        return
      } else {
        tween1.reversed(!tween1.reversed())
        tween2.reversed(!tween2.reversed())
        tween3.reversed(!tween3.reversed())
        tween4.reversed(!tween4.reversed())
        tween5.reversed(!tween5.reversed())
        tween6.reversed(!tween6.reversed())
        tween7.reversed(!tween7.reversed())
        tween8.reversed(!tween8.reversed())
        tween9.reversed(!tween9.reversed())
        // tween10.reversed(!tween10.reversed())
      }
    }

    $('#fold_floor').on('click', function () {
      fold_all()
    })
    //进入大楼
    $('#in_ex_floor').on('click', function () {
      $('#back_all').show()

      // removeEntity('all')
      hiddenObject('all')
      hiddenObject('other')
      hiddenObject('ground')
      hiddenObject('road')

      removeEntity('directionalLight')
      directionalLight = new THREE.DirectionalLight(0xffffff, 1)
      directionalLight.position.set(5, 1.601, 57.199)
      scene.add(directionalLight)

      // removeEntity('directionalLight2')

      removeEntity('ambient')
      ambient = new THREE.AmbientLight(0x888888, 1)
      ambient.name = 'ambient'
      scene.add(ambient)

      showObject('1floor')
      showObject('2floor')
      showObject('3floor')
      showObject('4floor')
      showObject('5floor')
      showObject('6floor')
      showObject('7floor')
      showObject('8floor')
      showObject('9floor')

      // $('#bottomFloor').show()
      // if (model_floor1.position.y != 0) {
      //   return
      // } else {
      //   //增加每层模型
      //   model_all_num['model_all_floor' + 1].push(model_floor1.position)
      //   model_all_num['model_all_floor' + 2].push(model_floor2.position)
      //   model_all_num['model_all_floor' + 3].push(model_floor3.position)
      //   model_all_num['model_all_floor' + 4].push(model_floor4.position)
      //   model_all_num['model_all_floor' + 5].push(model_floor5.position)
      //   model_all_num['model_all_floor' + 6].push(model_floor6.position)
      //   model_all_num['model_all_floor' + 7].push(model_floor7.position)
      //   model_all_num['model_all_floor' + 8].push(model_floor8.position)
      //   model_all_num['model_all_floor' + 9].push(model_floor9.position)

      //   // model_all_floorB1.push(model_floorB1.position)

      //   tween1 = TweenMax.to(model_all_num['model_all_floor' + 1], 2, {
      //     y: -120,
      //     ease: Power3.easeOut, //Linear.easeNone
      //   })
      //   tween2 = TweenMax.to(model_all_num['model_all_floor' + 2], 2, {
      //     y: -90,
      //     ease: Power3.easeOut,
      //   })
      //   tween3 = TweenMax.to(model_all_num['model_all_floor' + 3], 2, {
      //     y: -60,
      //     ease: Power3.easeOut,
      //   })
      //   tween4 = TweenMax.to(model_all_num['model_all_floor' + 4], 2, {
      //     y: -30,
      //     ease: Power3.easeOut,
      //   })
      //   tween5 = TweenMax.to(model_all_num['model_all_floor' + 5], 2, {
      //     y: 0,
      //     ease: Power3.easeOut,
      //   })
      //   tween6 = TweenMax.to(model_all_num['model_all_floor' + 6], 2, {
      //     y: 30,
      //     ease: Power3.easeOut,
      //   })
      //   tween7 = TweenMax.to(model_all_num['model_all_floor' + 7], 2, {
      //     y: 60,
      //     ease: Power3.easeOut,
      //   })
      //   tween8 = TweenMax.to(model_all_num['model_all_floor' + 8], 2, {
      //     y: 90,
      //     ease: Power3.easeOut,
      //   })
      //   tween9 = TweenMax.to(model_all_num['model_all_floor' + 9], 2, {
      //     y: 120,
      //     ease: Power3.easeOut,
      //   })

      // tween10 = TweenMax.to(model_all_floorB1, 2, {
      //   y: -1000,
      //   ease: Power3.easeOut
      // });
      // modelTraverse()
      // tween_smoke = TweenMax.to()

      // moveFloor()


      // tween1.play()
      // tween2.play()
      // tween3.play()
      // tween4.play()
      // tween5.play()
      // tween6.play()
      // tween7.play()
      // tween8.play()
      // tween9.play()
      // tween10.play()
      // }

      // let component = model_floor1.getObjectByName('1floor')
    })

    var test = 'model_video'
    let model_position

    //隐藏模型
    function hiddenObject(obj) {
      let selectedObject = scene.getObjectByName(obj)
      console.log(selectedObject)
      selectedObject.visible = false
    }
    //显示模型
    function showObject(obj) {
      let selectedObject = scene.getObjectByName(obj)
      console.log(selectedObject)
      selectedObject.visible = true
    }
    //移除模型
    function removeEntity(object) {
      let selectedObject = scene.getObjectByName(object)
      scene.remove(selectedObject)
    }

    //遍历所有模型
    function modelTraverse() {
      for (let i = 0; i < scene.children.length; i++) {
        model_all.push(scene.children[i])
      }
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight //相机视锥体的长宽比
      camera.updateProjectionMatrix() //更新相机投影矩阵

      renderer.setSize(window.innerWidth, window.innerHeight) //渲染器大小
    }

    function draw() {
      init()
      // loadModel('./assets/new_gltf/内部建模/4楼/会议厅.gltf', 'room1', 4)
      // loadModel('./assets/new_gltf/内部建模/4楼/会议桌.gltf', 'room2', 4)
      // loadModel('./assets/new_gltf/内部建模/4楼/办公室1.gltf', 'room3', 4)
      // loadModel('./assets/new_gltf/内部建模/4楼/办公室2.gltf', 'room4', 4)
      // loadModel('./assets/new_gltf/内部建模/4楼/办公室3.gltf', 'room5', 4)
      // loadModel('./assets/new_gltf/内部建模/4楼/办公室4.gltf', 'room6', 4)
      // loadModel('./assets/new_gltf/内部建模/4楼/办公室5.gltf', 'room7', 4)
      // loadModel('./assets/new_gltf/内部建模/4楼/办公室6.gltf', 'room8', 4)
      // loadModel(video_path, 'video1', 3, -25.2, 0, 0)
      // loadModel(video_path, 'video2', 3, -23.93, 0, -53.375)
      // loadModel(video_path, 'video3', 3, 4.84, 0, 70.834)
      // loadModel(video_path, 'video4', 3, 0, 0, 0)
      // loadModel(smoke_path, 'smoke1', 3, 6.047, 5, 0.15)
      // loadModel(smoke_path, 'smoke2', 3, 6.047, 5, 60.5)
      // loadModel(smoke_path, 'smoke3', 3, 14.973, 5, 124.95)
      // loadModel(gate_path, 'gate1', 1, 1.687, 0, 18.373)
      // loadModel(gate_path, 'gate2', 1, -0.904, 0, -22.398)
      //x: 1.687. y: 0 z: 18.373
      //x: -0.904 y: 0.000 z: -22.398

      // initStats() //加载性能监视
      animate()
      // createIcon('video1', 'videoIcon')
      // createIcon('video2', 'videoIcon')
      // createIcon('video3', 'videoIcon')
      // createIcon('video4', 'videoIcon')
      // createIcon('gate1', 'gateIcon')
      // createIcon('gate2', 'gateIcon')
      // createIcon('smoke1', 'smokeIcon')
      // createIcon('smoke2', 'smokeIcon')
      // createIcon('smoke3', 'smokeIcon')
      // createLayer('video1_ly', 'videoLayer')
      // createLayer('video2_ly', 'videoLayer')
      // createLayer('video3_ly', 'videoLayer')
      // createLayer('video4_ly', 'videoLayer')
      // createLayer('gate1_ly', 'gateLayer')
      // createLayer('gate2_ly', 'gateLayer')
      // createLayer('smoke1_ly', 'smokeLayer')
      // createLayer('smoke2_ly', 'smokeLayer')
      // createLayer('smoke3_ly', 'smokeLayer')

      $('.videoIcon').hide() //隐藏所有3D图标
      $('.gateIcon').hide()
      $('.smokeIcon').hide()

      layer_show('videoIcon')
      layer_show('gateIcon')
      layer_show('smokeIcon')
    }

    // function world2Screen(x, y, z) {
    //   let worldVector = new THREE.Vector3(x, y, z);
    //   let vector = worldVector.project(camera);

    //   let halfWidth = window.innerWidth / 2;
    //   let halfHeight = window.innerHeight / 2;

    //   let result = {
    //     x: Math.round(vector.x * halfWidth + halfWidth),
    //     y: Math.round(-vector.y * halfHeight + halfHeight)
    //   };

    //   return result;
    // }
    // 更新div的位置
    // function renderDiv(object, intersect) {
    //   let {
    //     point: {
    //       x,
    //       y,
    //       z
    //     }
    //   } = intersect;
    //   let position = world2Screen(x, y, z);

    //   // let testIcon = createIcon(object.name)
    // createIcon(object.name).css({
    //   'left': position.x + (-20) + 'px',
    //   'top': position.y + (-55) + 'px'
    // })
    //   $(".testDiv").text(object.name).css({
    //     'left': position.x + 'px',
    //     'top': position.y + 25 + 'px'
    //   });
    // }

    //添加ICON的dom
    function createIcon(mesh_id, class_name) {
      let iconDiv = document.createElement('div')
      iconDiv.className = class_name
      iconDiv.id = mesh_id
      let bodyDom = document.body
      bodyDom.insertBefore(iconDiv, bodyDom.lastChild)
      let iconDivid = $('#' + mesh_id)
      return iconDivid
    }
    //添加弹窗dom
    function createLayer(mesh_id, class_name) {
      let iconDiv = document.createElement('div')
      iconDiv.className = class_name
      iconDiv.id = mesh_id
      let bodyDom = document.body
      bodyDom.insertBefore(iconDiv, bodyDom.lastChild)
      let layerDivid = $('#' + mesh_id)
      return layerDivid
    }

    function renderDiv() {
      let halfWidth = window.innerWidth / 2
      let halfHeight = window.innerHeight / 2

      let xOffset = -18
      let yOffset = -60

      let testDiv = $('.testDiv')
      let groupNames = [
        'video1',
        'video2',
        'video3',
        'video4',
        'gate1',
        'gate2',
        'smoke1',
        'smoke2',
        'smoke3',
      ]

      for (let i = 0; i < groupNames.length; i++) {
        let groupName = groupNames[i]
        let group = scene.getObjectByName(groupName)
        if (group) {
          let mesh
          group.traverse(function (child) {
            if (child.isMesh) {
              mesh = child
            }
          })

          let vector = new THREE.Vector3()
          mesh.getWorldPosition(vector)
          vector.project(camera)
          // $("#" + groupName).css({
          //   left: vector.x * halfWidth + halfWidth + xOffset,
          //   top: -vector.y * halfHeight + halfHeight + yOffset
          // });
          //图标位置
          $('#' + groupName).css({
            left: vector.x * halfWidth + halfWidth + xOffset,
            top: -vector.y * halfHeight + halfHeight + yOffset,
          })
          //弹框位置
          $('#' + groupName + '_ly').css({
            left: vector.x * halfWidth + halfWidth + 2,
            top: -vector.y * halfHeight + halfHeight + -206,
          })

          let g = testDiv.data('group')
          if (g === groupName) {
            $('.testDiv')
              .text(groupName)
              .css({
                left: vector.x * halfWidth + halfWidth + 10,
                top: -vector.y * halfHeight + halfHeight + 10,
              })
          }
        }
      }
    }

    function animate() {
      // stats.update()
      controls.update()
      renderer.render(scene, camera)
      requestAnimationFrame(animate)
      renderDiv()
    }

    function loadModel(path, gltf_name, floor_num, pst_x, pst_y, pst_z) {
      new THREE.GLTFLoader().load(path, function (gltf) {
        gltf.scene.name = gltf_name //set模型名字
        if (pst_x, pst_y, pst_z) {
          gltf.scene.position.set(pst_x, pst_y, pst_z) //set模型位置
        }

        model_all_num['model_all_floor' + floor_num].push(gltf.scene.position) //添加模型所在楼层位置

        // model.position.set(0, 60, 0);
        // let sc = 3;
        model = gltf.scene.children[0]
        model.traverse(function (child) {
          //对模型体内的每个几何体进行遍历
          if (child.isMesh) {
            child.castShadow = true //允许模型本身对自己产生阴影
            child.receiveShadow = true //接受阴影渲染
            // child.scale.set(sc, sc, sc); //模型重置比例放大。

            Vplace1.push(child)
          }
        })

        scene.add(gltf.scene)
      })
    }

    document.addEventListener(
      'click',
      function () {
        ray(Vplace1)
      },
      false,
    )

    function getGroup(groupName, mesh) {
      let { parent } = mesh
      while (parent) {
        if (parent.isGroup && parent.name === groupName) {
          return parent
        }

        parent = parent.parent
      }
    }

    function ray(Bplace) {
      // var Sx = event.clientX; //鼠标单击位置横坐标
      // var Sy = event.clientY; //鼠标单击位置纵坐标

      // //屏幕坐标转标准设备坐标
      // var x = (Sx / window.innerWidth) * 2 - 1; //标准设备横坐标
      // var y = -(Sy / window.innerHeight) * 2 + 1; //标准设备纵坐标
      // var standardVector = new THREE.Vector3(x, y, 0.5); //标准设备坐标

      // //标准设备坐标转世界坐标
      // var worldVector = standardVector.unproject(camera);

      //射线投射方向单位向量(worldVector坐标减相机位置坐标)
      // var ray = worldVector.sub(camera.position).normalize();
      //创建射线投射器对象
      // var raycaster = new THREE.Raycaster(camera.position, ray);
      //方法2
      let x = event.clientX
      let y = event.clientY
      let mouse = new THREE.Vector2()

      mouse.x = (x / window.innerWidth) * 2 - 1
      mouse.y = -(y / window.innerHeight) * 2 + 1

      var raycaster = new THREE.Raycaster()
      raycaster.setFromCamera(mouse, camera)

      //返回射线选中的对象
      var intersects = raycaster.intersectObjects(Bplace) //Bplace为需要被点击的目标体池集合

      if (intersects.length > 0) {
        console.log('拾取到了')

        let obj = intersects[0].object

        let groupNames = ['video1', 'video2', 'video3', 'video4']
        for (let i = 0; i < groupNames.length; i++) {
          let groupName = groupNames[i]
          let group = scene.getObjectByName(groupName)

          if (getGroup(groupName, obj)) {
            let child = scene.getObjectByName(groupName)
            child.traverse(function (obj) {
              if (obj.isMesh) {
                obj.material.color.set(0xff0000)
              }
            })

            $('#' + groupName).show()
            $('.testDiv').data('group', groupName)
          }
        }
      }
    }
    //返回主场景
    $('#back_all').on('click', function () {
      back_to_home()
      $('#bottomFloor').hide()
    })

    function back_to_home() {
      fold_all()
      let selectedObject = scene.getObjectByName('all')
      setTimeout(function () {
        selectedObject.visible = true
      }, 1000)
      $('.videoIcon').hide()
      $('.gateIcon').hide()
      if ((selectedObject.visible = true)) {
        $('#back_all').hide()
      }
    }
    //顶部tab


    //安防监控按钮
    $('#people_moni').on('click', function () {
      if ($('.videoIcon').is(':hidden')) {
        $('.videoIcon').show()
      } else {
        $('.videoIcon').hide()
      }
    })
    //闸机按钮
    $('#gate').on('click', function () {
      if ($('.gateIcon').is(':hidden')) {
        $('.gateIcon').show()
      } else {
        $('.gateIcon').hide()
      }
    })
    //烟感按钮
    $('#smoke').on('click', function () {
      if ($('.smokeIcon').is(':hidden')) {
        $('.smokeIcon').show()
      } else {
        $('.smokeIcon').hide()
      }
    })

    //弹窗
    function layer_show(clk_icon_classname) {
      $('.' + clk_icon_classname).on('click', function () {
        let this_id = $(this).attr('id')
        if ($('#' + this_id + '_ly').is(':hidden')) {
          $('#' + this_id + '_ly').show()
        } else {
          $('#' + this_id + '_ly').hide()
        }
      })
    }

    $('#camera_position').on('click', function () {
      console.log(camera)
    })

    //跳转楼层按钮
    $('#f1').on('click', function () {
      for (let i = 2; i <= 9; i++) {
        hiddenObject(i + 'floor')
      }

      tween_camera = TweenMax.to(camera.position, 2, {
        x: 10,
        y: 150,
        z: 0,
        ease: Expo.easeInOut, //Linear.easeNone  Cubic.easeIn
        //Power3.easeOut
      })
    })

    $('#f9').on('click', function () { })
  </script>
</body>

</html>